<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Playlist de MÃºsica</title>
    <link rel="stylesheet" th:href="@{/style.css}" />
  </head>

  <body>
    <header class="topbar">
        <div class="container header-row">
        <div>
          <h1 id="site-title">ðŸŽµ Mi Playlist de MÃºsica</h1>
          <p class="subtitle">Gestiona y reproduce tus videos favoritos</p>
        </div>
        <div class="header-actions">
          <button id="theme-toggle" class="btn theme-btn" aria-pressed="false" title="Alternar tema">
            <!-- default: moon icon (switch to dark) -->
            <span id="theme-icon" class="theme-icon">
              <!-- improved moon icon (stroke) -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
            </span>
          </button>
        </div>
      </div>
    </header>

    <main class="container layout">
      <section class="add-card">
        <h2>Agregar Video</h2>
        <form action="/add" method="post" class="form">
          <label>TÃ­tulo del Video
            <input type="text" name="name" placeholder="Ej: Mi canciÃ³n favorita" required />
          </label>

          <label>URL de YouTube
            <input type="text" name="url" placeholder="https://www.youtube.com/watch?v=..." required />
          </label>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">ï¼‹ Agregar Video</button>
          </div>
        </form>
      </section>

      <section class="playlist">
        <h2>Playlist (<span th:text="${#lists.size(videos)}">0</span> videos)</h2>

        <div class="playlist-list">
          <div class="video-card" th:each="video, iterStat : ${videos}"
               th:data-id="${video.id}"
               th:data-embed="${video.embedUrl}"
               th:data-name="${video.name}"
               onclick="selectVideo(this)">

            <div class="video-info">
              <div class="video-title" th:text="${video.name}">Titulo</div>
              <div class="video-url" th:text="${video.url}">https://...</div>
            </div>

                <div class="video-actions">
                  <!-- Like -->
                  <form method="post" th:action="@{'/like/' + ${video.id}}" onsubmit="event.stopPropagation();">
                    <button class="icon btn-like" title="Like" onclick="event.stopPropagation();" type="submit">
                      <!-- heart SVG -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.1 21.35l-1.1-.99C5.14 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.54 0 3.04.99 3.57 2.36h1.87C13.46 4.99 14.96 4 16.5 4 19 4 21 6 21 8.5c0 3.78-3.14 6.86-8.9 11.86l-1.0.99z"/></svg>
                    </button>
                    <span class="count" th:text="${video.likes}">0</span>
                  </form>

                  <!-- Favorite -->
                  <form method="post" th:action="@{'/favorite/' + ${video.id}}" onsubmit="event.stopPropagation();">
                    <button th:class="${video.favorite} ? 'icon btn-fav active' : 'icon btn-fav'" th:attr="title='Favorito'" th:attrappend="aria-pressed=${video.favorite}" type="submit" onclick="event.stopPropagation();">
                      <!-- star SVG -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    </button>
                  </form>

                  <!-- Move up/down -->
                  <div class="move-group">
                    <form method="post" th:action="@{'/move-up/' + ${video.id}}" onsubmit="event.stopPropagation();">
                      <button class="icon btn-move" type="submit" th:disabled="${iterStat.index == 0}" title="Subir" onclick="event.stopPropagation();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
                      </button>
                    </form>

                    <form method="post" th:action="@{'/move-down/' + ${video.id}}" onsubmit="event.stopPropagation();">
                      <button class="icon btn-move" type="submit" th:disabled="${iterStat.last}" title="Bajar" onclick="event.stopPropagation();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/></svg>
                      </button>
                    </form>
                  </div>

                  <!-- Delete -->
                  <form method="post" th:action="@{'/delete/' + ${video.id}}" onsubmit="event.stopPropagation();">
                    <button class="icon btn-delete" title="Eliminar" onclick="event.stopPropagation();" type="submit">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                    </button>
                  </form>
                </div>
          </div>
        </div>
      </section>

      <section class="player">
        <h2>Reproduciendo</h2>
        <div class="player-card">
          <div class="player-title" id="player-title">Selecciona un video</div>
          <div class="player-frame">
            <iframe id="player-iframe" src="" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
          </div>
        </div>
      </section>

    </main>

    <script>
      // Selecciona el primer video al cargar
      function selectVideo(element) {
        var embed = element.getAttribute('data-embed');
        var title = element.getAttribute('data-name');
        var id = element.getAttribute('data-id');

        var iframe = document.getElementById('player-iframe');
        var playerTitle = document.getElementById('player-title');

        iframe.src = embed ? embed : '';
        playerTitle.textContent = title ? title : 'Selecciona un video';

        // highlight
        document.querySelectorAll('.video-card').forEach(function(c){ c.classList.remove('selected'); });
        element.classList.add('selected');
      }

      window.addEventListener('DOMContentLoaded', function(){
        var first = document.querySelector('.video-card');
        if(first) selectVideo(first);
      });
      // Theme (dark mode) handling
      (function(){
        var toggle = document.getElementById('theme-toggle');
        var icon = document.getElementById('theme-icon');
        var siteTitle = document.getElementById('site-title');
        var body = document.body;
        function applyTheme(theme){
          if(theme === 'dark'){
            body.classList.add('dark-mode');
            // sun icon (stroke, clear rays)
            icon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 3v2"/>\n  <path d="M12 19v2"/>\n  <path d="M4.22 4.22l1.42 1.42"/>\n  <path d="M18.36 18.36l1.42 1.42"/>\n  <path d="M1 12h2"/>\n  <path d="M21 12h2"/>\n  <path d="M4.22 19.78l1.42-1.42"/>\n  <path d="M18.36 5.64l1.42-1.42"/>\n  <circle cx="12" cy="12" r="4"/>\n</svg>';
            toggle.setAttribute('aria-pressed','true');
            if(siteTitle) siteTitle.style.color = '#ffffff';
          } else {
            body.classList.remove('dark-mode');
            // moon icon (stroke)
            icon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>';
            toggle.setAttribute('aria-pressed','false');
            if(siteTitle) siteTitle.style.color = '';
          }
        }

        // init from localStorage
        var saved = null;
        try { saved = localStorage.getItem('theme'); } catch(e) { saved = null; }
        if(saved) applyTheme(saved);
        else {
          // set initial icon based on current (light)
          applyTheme('light');
        }

        toggle.addEventListener('click', function(){
          var isDark = body.classList.contains('dark-mode');
          var next = isDark ? 'light' : 'dark';
          try { localStorage.setItem('theme', next); } catch(e) {}
          applyTheme(next);
        });
      })();
    </script>
  </body>
</html>
